<!DOCTYPE html>
<html lang="fr"
      data-th-replace="~{layout::layout(contenu=~{::main},titre=~{::title})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Détail de l'enchère</title>
    <link rel="stylesheet" th:href="@{/css/details.css}"/>
</head>
<body>
<main class="detail-container">
    <!-- Messages d'alerte -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    
    <div class="detail-table">
        <div class="row">
            <div class="cell label">Article :</div>
            <div class="cell value" th:text="${article.nom_article}"></div>
            <div class="cell label">Mise à prix :</div>
            <div class="cell value" th:text="${article.prix_initial} + ' point(s)' "></div>
        </div>
        <div class="row">
            <div class="cell label">Catégorie :</div>
            <div class="cell value" th:text="${article.categorie.libelle}"></div>
            <div class="cell label">Meilleure offre :</div>
            <div class="cell value" th:text="${meilleureOffre} + ' point(s)'"></div>
        </div>
        <div class="row">
            <div class="cell label">Description :</div>
            <div class="cell value" th:text="${article.description}" colspan="3"></div>
            <div class="cell label">Fin de l'enchère :</div>
            <div class="cell value" th:text="${#dates.format(article.date_fin_enchere, 'dd/MM/yyyy HH:mm')}"></div>
            <div class="cell label">Temps restant :</div>
            <div class="cell value">
                <div id="countdown" th:data-date-fin="${dateFinFormatted}">
                    Chargement...
                </div>
            </div>
        </div>
    </div>
    
    <div class="detail-bottom">
        <div class="retrait">
            <span class="label">Retrait :</span>
            <span class="value" th:text="${article.adresse_retrait.rue + ' ' + article.adresse_retrait.code_postal + ' ' + article.adresse_retrait.ville}"></span>
        </div>
        <div class="vendeur">
            <span class="label">Vendeur :</span>
            <a data-th-href="@{/profil(pseudo=${article.vendeur.pseudo})}" class="value" th:text="${article.vendeur.pseudo}"></a>
        </div>
        
        <!-- Formulaire d'enchère -->
        <div th:if="${peutEncherir}" class="enchere-section">
            <form th:action="@{/enchere/soumettre}" method="post" class="enchere-form">
                <input type="hidden" name="no_article" th:value="${article.no_article}">
                
                <div class="enchere-input">
                    <label for="montant_propose">Votre enchère :</label>
                    <input type="number" 
                           id="montant_propose" 
                           name="montant_propose" 
                           th:min="${montantMinimum}" 
                           th:placeholder="'Minimum : ' + ${montantMinimum} + ' points'"
                           required>
                    <span class="montant-info">Minimum : <span th:text="${montantMinimum}"></span> points</span>
                </div>
                
                <div class="button-detail">
                    <button type="submit" class="btn btn-primary">Enchérir</button>
                </div>
            </form>
        </div>
        
        <!-- Message si l'utilisateur ne peut pas enchérir -->
        <div th:unless="${peutEncherir}" class="enchere-section">
            <div th:if="${#authorization.expression('isAuthenticated()')}" class="alert alert-info">
                Vous ne pouvez pas enchérir sur votre propre article.
            </div>
            <div th:unless="${#authorization.expression('isAuthenticated()')}" class="alert alert-warning">
                Vous devez être connecté pour enchérir.
                <a th:href="@{/connexion}" class="btn btn-secondary">Se connecter</a>
            </div>
        </div>
        
        <div class="button-detail">
            <a th:href="@{/enchere}" class="btn btn-secondary">Retour à la liste</a>
        </div>
    </div>

</main>
</body>
</html>