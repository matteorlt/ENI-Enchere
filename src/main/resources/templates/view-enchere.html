<!DOCTYPE html>
<html lang="fr"
      data-th-replace="~{layout::layout(contenu=~{::main},titre=~{::title})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Liste des enchÃ¨res</title>
</head>
<body>
    <div th:replace="~{layout :: header}"></div>

    <main class="container">
        <section class="encheres-filters">
            <h4>Filtres :</h4>
            <form method="get" th:action="@{/enchere}" class="encheres-filters__form">
                <div class="encheres-filters__group">
                    <label for="nom" class="encheres-filters__label">Le nom de l'article contient :</label>
                    <input type="text" id="nom" name="nom" th:value="${nom}" placeholder="Rechercher..." class="encheres-filters__input">
                </div>
                
                <div class="encheres-filters__group">
                    <label for="categorie" class="encheres-filters__label">CatÃ©gorie :</label>
                    <select name="categorie" id="categorie" class="encheres-filters__select">
                        <option value="">Toutes les catÃ©gories</option>
                        <option th:each="cat : ${categories}" 
                                th:value="${cat.libelle}" 
                                th:text="${cat.libelle}"
                                th:selected="${cat.libelle == categorie}">
                        </option>
                    </select>
                </div>
                
                <div class="encheres-filters__group" th:if="${#authorization.expression('isAuthenticated()')}">
                    <label for="mesEncheres" class="encheres-filters__checkbox-label">
                        <input type="checkbox" id="mesEncheres" name="mesEncheres" th:checked="${mesEncheres}" class="encheres-filters__checkbox">
                        Mes ventes
                    </label>
                    <br>
                    <label for="mesEncheresFaites" class="encheres-filters__checkbox-label">
                        <input type="checkbox" id="mesEncheresFaites" name="mesEncheresFaites" th:checked="${mesEncheresFaites}" class="encheres-filters__checkbox">
                        Mes enchÃ¨res
                    </label>
                </div>
                
                <div class="encheres-filters__group">
                    <label for="statut" class="encheres-filters__label">Filtrer par statut :</label>
                    <select id="statut" name="statut" class="encheres-filters__select">
                        <option value="">Tous les statuts</option>
                        <option value="debut" th:selected="${statut == 'debut'}">ğŸ’› Pas commencÃ©</option>
                        <option value="actif" th:selected="${statut == 'actif'}">ğŸ’š En cours</option>
                        <option value="termine" th:selected="${statut == 'termine'}">ğŸ”´ TerminÃ©</option>
                    </select>
                </div>
                
                <div class="encheres-filters__buttons">
                    <button type="submit" class="btn btn--primary">Rechercher</button>
                    <a th:href="@{/enchere}" class="btn btn--secondary">Annuler</a>
                </div>
            </form>
        </section>
        
        <section>
            <h2>Liste des enchÃ¨res</h2>
            <div class="encheres-grid">
                <a th:each="enchere : ${encheres}" th:href="@{/details(no_article=${enchere.no_article})}" class="encheres-card">
                    <!-- Photo de l'article via le contrÃ´leur PhotoController -->
                    <img th:if="${enchere.photo != null and enchere.photo != ''}" 
                         th:src="@{'/images/articles/' + ${enchere.no_article}}"
                         th:alt="${enchere.nom_article}"
                         class="encheres-card__image" />
                    
                    <!-- Image par dÃ©faut si pas de photo -->
                    <img th:unless="${enchere.photo != null and enchere.photo != ''}" 
                         src="/images/default.webp"
                         alt="Image par dÃ©faut" 
                         class="encheres-card__image" />
                         
                    <h3 class="encheres-card__title" th:text="${enchere.nom_article}">Nom</h3>
                    
                    <!-- Affichage du statut temporel -->
                    <p class="encheres-status">
                        <span th:if="${enchere.date_debut_enchere.after(new java.util.Date())}" class="encheres-status--pending">ğŸ’› Pas commencÃ©</span>
                        <span th:if="${!enchere.date_debut_enchere.after(new java.util.Date()) && enchere.date_fin_enchere.after(new java.util.Date())}" class="encheres-status--active">ğŸ’š En cours</span>
                        <span th:if="${!enchere.date_fin_enchere.after(new java.util.Date())}" class="encheres-status--finished">ğŸ”´ TerminÃ©</span>
                    </p>
                    
                    <p class="encheres-card__price">Prix : <span th:text="${enchere.prix_vente != null ? enchere.prix_vente : enchere.prix_initial}">0</span> point(s)</p>
                    <p class="encheres-card__details">Fin de l'enchÃ¨re : <span th:text="${#dates.format(enchere.date_fin_enchere, 'dd/MM/yyyy')}">01/06/202X</span></p>
                    <p class="encheres-card__details">Vendeur : <span th:text="${enchere.vendeur.pseudo}">vendeur</span></p>
                </a>
            </div>
            <div th:if="${encheres == null or #lists.isEmpty(encheres)}" class="text-center p-5">
                <p class="text-muted">Aucune enchÃ¨re trouvÃ©e.</p>
            </div>
        </section>
    </main>

    <div th:replace="~{layout :: footer}"></div>

    <script>
        // EmpÃªcher que les deux checkboxes "Mes ventes" et "Mes enchÃ¨res" soient cochÃ©es en mÃªme temps
        document.addEventListener('DOMContentLoaded', function() {
            const mesEncheres = document.getElementById('mesEncheres');
            const mesEncheresFaites = document.getElementById('mesEncheresFaites');
            
            if (mesEncheres && mesEncheresFaites) {
                mesEncheres.addEventListener('change', function() {
                    if (this.checked) {
                        mesEncheresFaites.checked = false;
                    }
                });
                
                mesEncheresFaites.addEventListener('change', function() {
                    if (this.checked) {
                        mesEncheres.checked = false;
                    }
                });
            }
        });
    </script>
</body>
</html>