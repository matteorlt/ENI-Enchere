<!DOCTYPE html>
<html lang="fr"
      data-th-replace="~{layout::layout(contenu=~{::main},titre=~{::title})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Liste des enchÃ¨res</title>
</head>
<body>
    <div th:replace="~{layout :: header}"></div>

    <main>
        <section class="filtres-section">
            <h4>Filtres :</h4>
            <form method="get" th:action="@{/enchere}" class="filtres-form">
                <div class="filtre-groupe">
                    <label for="nom">Le nom de l'article contient :</label>
                    <input type="text" id="nom" name="nom" th:value="${nom}" placeholder="Rechercher...">
                </div>
                
                <div class="filtre-groupe">
                    <label for="categorie">CatÃ©gorie :</label>
                    <select name="categorie" id="categorie">
                        <option value="">Toutes les catÃ©gories</option>
                        <option th:each="cat : ${categories}" 
                                th:value="${cat.libelle}" 
                                th:text="${cat.libelle}"
                                th:selected="${cat.libelle == categorie}">
                        </option>
                    </select>
                </div>
                
                <div class="filtre-groupe">
                    <label for="mesEncheres">
                        <input type="checkbox" id="mesEncheres" name="mesEncheres" th:checked="${mesEncheres}">
                        Mes enchÃ¨res
                    </label>
                </div>
                
                <div class="filtre-groupe">
                    <label for="statut">Filtrer par statut :</label>
                    <select id="statut" name="statut">
                        <option value="">Tous les statuts</option>
                        <option value="debut" th:selected="${statut == 'debut'}">ğŸ’› Pas commencÃ©</option>
                        <option value="actif" th:selected="${statut == 'actif'}">ğŸ’š En cours</option>
                        <option value="termine" th:selected="${statut == 'termine'}">ğŸ”´ TerminÃ©</option>
                    </select>
                </div>
                
                <div class="boutons-filtres">
                    <button type="submit" class="btn-rechercher">Rechercher</button>
                    <a th:href="@{/enchere}">
                        <button type="button" class="btn-annuler">Annuler</button>
                    </a>
                </div>
            </form>
        </section>
        
        <section>
            <h2>Liste des enchÃ¨res</h2>
            <div th:each="enchere : ${encheres}">
                <a th:href="@{/details(no_article=${enchere.no_article})}" class="article-card">
                    <!-- Photo de l'article via le contrÃ´leur PhotoController -->
                    <img th:if="${enchere.photo != null and enchere.photo != ''}" 
                         th:src="@{'/images/articles/' + ${enchere.no_article}}"
                         th:alt="${enchere.nom_article}"
                         class="article-image" />
                    
                    <!-- Image par dÃ©faut si pas de photo -->
                    <img th:unless="${enchere.photo != null and enchere.photo != ''}" 
                         src="/images/default.webp"
                         alt="Image par dÃ©faut" 
                         class="article-image default-image" />
                         
                    <h3 th:text="${enchere.nom_article}">Nom</h3>
                    
                    <!-- Affichage du statut temporel -->
                    <p class="statut-enchere">
                        <span th:if="${enchere.date_debut_enchere.after(new java.util.Date())}" class="statut-debut">ğŸ’› Pas commencÃ©</span>
                        <span th:if="${!enchere.date_debut_enchere.after(new java.util.Date()) && enchere.date_fin_enchere.after(new java.util.Date())}" class="statut-actif">ğŸ’š En cours</span>
                        <span th:if="${!enchere.date_fin_enchere.after(new java.util.Date())}" class="statut-termine">ğŸ”´ TerminÃ©</span>
                    </p>
                    
                    <p class="prix">Prix : <span th:text="${enchere.prix_vente != null ? enchere.prix_vente : enchere.prix_initial}">0</span> point(s)</p>
                    <p>Fin de l'enchÃ¨re : <span th:text="${#dates.format(enchere.date_fin_enchere, 'dd/MM/yyyy')}">01/06/202X</span></p>
                    <p>Vendeur : <span th:text="${enchere.vendeur.pseudo}">vendeur</span></p>
                </a>
            </div>
            <div th:if="${encheres == null or #lists.isEmpty(encheres)}">
                <p>Aucune enchÃ¨re trouvÃ©e.</p>
            </div>
        </section>
    </main>

    <div th:replace="~{layout :: footer}"></div>
</body>
</html>